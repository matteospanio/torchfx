# 1.2 Installation

# Installation

<details>
<summary>Relevant source files</summary>

The following files were used as context for generating this wiki page:

- [pyproject.toml](pyproject.toml)
- [uv.lock](uv.lock)

</details>



## Purpose and Scope

This document describes the installation procedures for torchfx, including system requirements, installation methods, platform-specific PyTorch configuration, and dependency management. For a quick start guide with minimal setup, see [Quick Start](#1.1). For details on the development environment setup, see [Development Workflow](#7.3).

## System Requirements

torchfx requires **Python 3.10 or higher** as specified in [pyproject.toml:10](). The library is designed to run on multiple platforms with different hardware acceleration capabilities:

| Platform | PyTorch Backend | CUDA Support |
|----------|----------------|--------------|
| Linux | CUDA 12.4 | Yes |
| macOS | CPU | No |
| Windows | CPU | No |

The platform-specific PyTorch configuration is defined in [pyproject.toml:50-68]() using the `uv` package manager's source selection mechanism.

**Core Dependencies:**

- `torch>=2.6.0` - PyTorch tensor library
- `torchaudio>=2.6.0` - Audio I/O and transforms
- `numpy>=2.2.4` - Numerical computing
- `scipy>=1.15.2` - Signal processing algorithms
- `soundfile>=0.13.1` - Audio file reading/writing
- `annotated-types>=0.7.0` - Type annotation support

These are declared in [pyproject.toml:11-18]().

## Installation Methods

### Installation via pip

The simplest installation method is through PyPI:

```bash
pip install torchfx
```

This installs the package with platform-appropriate PyTorch binaries. On Linux systems, this will attempt to install CUDA 12.4-enabled PyTorch; on macOS and Windows, it will install CPU-only versions.

### Installation from Source with uv

For development or to use the latest unreleased features, install from source using the `uv` package manager:

```bash
# Install uv if not already installed
pip install uv

# Clone the repository
git clone https://github.com/matteospanio/torchfx
cd torchfx

# Install in editable mode with all dependencies
uv sync
```

The `uv sync` command reads [pyproject.toml]() and [uv.lock]() to install all dependencies with exact versions for reproducible builds.

**Installation Workflow Diagram:**

```mermaid
graph TB
    User["User"]
    
    subgraph "Installation Methods"
        PipInstall["pip install torchfx"]
        SourceInstall["Clone + uv sync"]
    end
    
    subgraph "PyPI Distribution"
        PyPI["PyPI Registry"]
        Wheel["torchfx-0.2.1-*.whl"]
    end
    
    subgraph "Source Installation"
        GitRepo["GitHub Repository<br/>matteospanio/torchfx"]
        PyProject["pyproject.toml<br/>Dependencies definition"]
        UVLock["uv.lock<br/>Locked versions"]
        UV["uv package manager"]
    end
    
    subgraph "Dependency Resolution"
        DepResolver["Platform Detection"]
        LinuxPath["Linux:<br/>pytorch-cu124 index"]
        NonLinuxPath["macOS/Windows:<br/>pytorch-cpu index"]
        PyTorchCUDA["torch 2.6.0+cu124"]
        PyTorchCPU["torch 2.6.0+cpu"]
        OtherDeps["numpy, scipy<br/>soundfile, torchaudio"]
    end
    
    subgraph "Installed Package"
        TorchFXPkg["torchfx package<br/>in site-packages"]
    end
    
    User -->|pip install| PipInstall
    User -->|git clone + uv sync| SourceInstall
    
    PipInstall --> PyPI
    PyPI --> Wheel
    Wheel --> DepResolver
    
    SourceInstall --> GitRepo
    GitRepo --> PyProject
    GitRepo --> UVLock
    PyProject --> UV
    UVLock --> UV
    UV --> DepResolver
    
    DepResolver -->|sys_platform == 'linux'| LinuxPath
    DepResolver -->|sys_platform != 'linux'| NonLinuxPath
    
    LinuxPath --> PyTorchCUDA
    NonLinuxPath --> PyTorchCPU
    
    PyTorchCUDA --> TorchFXPkg
    PyTorchCPU --> TorchFXPkg
    DepResolver --> OtherDeps
    OtherDeps --> TorchFXPkg
```

**Sources:** [pyproject.toml:1-18](), [pyproject.toml:50-68]()

## Platform-Specific PyTorch Configuration

The `uv` package manager uses **platform markers** to select the appropriate PyTorch distribution. This configuration is defined in [pyproject.toml:50-68]().

**PyTorch Source Selection Logic:**

```mermaid
graph TD
    Start["Dependency Resolution Start"]
    
    PlatformCheck{"sys_platform == 'linux'?"}
    
    subgraph "Linux Path"
        CUDAIndex["[[tool.uv.index]]<br/>name = 'pytorch-cu124'<br/>url = download.pytorch.org/whl/cu124"]
        CUDASource["torch source:<br/>index = 'pytorch-cu124'<br/>marker = sys_platform == 'linux'"]
        CUDAPackage["torch 2.6.0+cu124<br/>torchaudio 2.6.0+cu124<br/>CUDA 12.4 support"]
    end
    
    subgraph "Non-Linux Path"
        CPUIndex["[[tool.uv.index]]<br/>name = 'pytorch-cpu'<br/>url = download.pytorch.org/whl/cpu"]
        CPUSource["torch source:<br/>index = 'pytorch-cpu'<br/>marker = sys_platform != 'linux'"]
        CPUPackage["torch 2.6.0+cpu<br/>torchaudio 2.6.0+cpu<br/>CPU-only"]
    end
    
    Result["Resolved torch package"]
    
    Start --> PlatformCheck
    PlatformCheck -->|Yes| CUDASource
    PlatformCheck -->|No| CPUSource
    
    CUDASource --> CUDAIndex
    CUDAIndex --> CUDAPackage
    CPUSource --> CPUIndex
    CPUIndex --> CPUPackage
    
    CUDAPackage --> Result
    CPUPackage --> Result
```

**Sources:** [pyproject.toml:50-68]()

The platform detection uses Python's `sys_platform` to determine which PyTorch index to use:

- **Linux systems** ([pyproject.toml:53]()): Resolves `torch` and `torchvision` from the `pytorch-cu124` index at `https://download.pytorch.org/whl/cu124`, providing CUDA 12.4 GPU acceleration.

- **macOS and Windows** ([pyproject.toml:52]()): Resolves from the `pytorch-cpu` index at `https://download.pytorch.org/whl/cpu`, providing CPU-only builds.

The `explicit = true` flag in [pyproject.toml:63, 68]() ensures these indices are only used when explicitly specified by the source configuration.

## Dependency Management with uv

The project uses **uv** as its primary dependency manager, which provides faster dependency resolution and reproducible builds through lock files.

**Dependency Resolution Components:**

```mermaid
graph TB
    subgraph "Configuration Files"
        PyProject["pyproject.toml"]
        UVLock["uv.lock"]
    end
    
    subgraph "Dependency Specifications"
        CoreDeps["[project.dependencies]<br/>torch>=2.6.0<br/>torchaudio>=2.6.0<br/>numpy>=2.2.4<br/>scipy>=1.15.2<br/>soundfile>=0.13.1<br/>annotated-types>=0.7.0"]
        
        DevGroups["[dependency-groups]<br/>cli: typer<br/>dev: black, mypy, pytest, ruff<br/>docs: sphinx, sphinx-immaterial"]
        
        UVSources["[tool.uv.sources]<br/>Platform-specific torch sources"]
        
        UVIndices["[[tool.uv.index]]<br/>pytorch-cpu<br/>pytorch-cu124"]
    end
    
    subgraph "Resolution Process"
        UVResolver["uv resolver engine"]
        PlatformDetect["Platform detection<br/>sys_platform"]
        VersionConstraints["Version constraint solver"]
    end
    
    subgraph "Lock File"
        LockedVersions["Exact package versions<br/>with hashes"]
        ResolvedDeps["Resolved dependency tree"]
    end
    
    subgraph "Installation"
        Download["Download packages"]
        Install["Install to environment"]
    end
    
    PyProject --> CoreDeps
    PyProject --> DevGroups
    PyProject --> UVSources
    PyProject --> UVIndices
    
    CoreDeps --> UVResolver
    DevGroups --> UVResolver
    UVSources --> PlatformDetect
    UVIndices --> PlatformDetect
    
    UVResolver --> VersionConstraints
    PlatformDetect --> VersionConstraints
    
    VersionConstraints --> LockedVersions
    VersionConstraints --> ResolvedDeps
    
    LockedVersions --> UVLock
    ResolvedDeps --> UVLock
    
    UVLock --> Download
    Download --> Install
```

**Sources:** [pyproject.toml:11-18](), [pyproject.toml:50-68](), [pyproject.toml:139-156]()

### Dependency Groups

The project defines optional dependency groups for different use cases:

| Group | Purpose | Key Packages |
|-------|---------|--------------|
| `cli` | Command-line interface | `typer>=0.16.0` |
| `dev` | Development tools | `black`, `mypy`, `pytest`, `ruff`, `coverage`, `scalene` |
| `docs` | Documentation building | `sphinx>=8.1.3`, `sphinx-immaterial>=0.13.5` |

These are defined in [pyproject.toml:139-156]().

To install with specific groups:

```bash
# Install with dev dependencies
uv sync --group dev

# Install with all groups
uv sync --all-groups

# Install only docs dependencies
uv sync --group docs
```

## Build System

The project uses **hatchling** as its build backend, specified in [pyproject.toml:135-137]():

```toml
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"
```

To build a distribution package:

```bash
# Using uv
uv build

# Or using standard tools
python -m build
```

This produces a wheel file (`.whl`) in the `dist/` directory that can be distributed or installed with pip.

**Sources:** [pyproject.toml:135-137]()

## Verification

After installation, verify that torchfx is correctly installed and can import all core components:

```python
import torchfx
from torchfx import Wave, FX, Gain, Normalize
from torchfx.filter import Butterworth, LowPass

# Check version
print(torchfx.__version__)  # Should print '0.2.1'

# Verify PyTorch backend
import torch
print(f"CUDA available: {torch.cuda.is_available()}")
print(f"PyTorch version: {torch.__version__}")
```

On Linux systems with NVIDIA GPUs, `torch.cuda.is_available()` should return `True`. On macOS and Windows, it will return `False`, indicating CPU-only operation.

To verify audio I/O capabilities:

```python
import torchaudio
print(f"torchaudio version: {torchaudio.__version__}")
print(f"Available backends: {torchaudio.list_audio_backends()}")
```

**Sources:** [pyproject.toml:2-3](), [pyproject.toml:11-18]()

## Troubleshooting

### PyTorch CUDA Version Mismatch

If you have an existing PyTorch installation with a different CUDA version, you may need to uninstall it first:

```bash
pip uninstall torch torchaudio torchvision
uv sync --reinstall-package torch
```

### Platform Detection Issues

If the wrong PyTorch variant is installed, verify your platform:

```python
import sys
print(f"Platform: {sys.platform}")
```

The marker `sys_platform == 'linux'` should be `True` on Linux systems.

### Dependency Conflicts

If you encounter dependency conflicts, regenerate the lock file:

```bash
rm uv.lock
uv lock
uv sync
```

**Sources:** [pyproject.toml:50-68]()